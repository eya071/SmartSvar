<!DOCTYPE html>
<html lang="nb">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartSvar – Chat</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>

  <body class="bg">
    <header class="topbar">
      <img
        src="{{ url_for('static', filename='SvarSmart_logo.png') }}"
        class="logo"
      />
    </header>

    <main class="chat-layout">
      <!-- VENSTRE PANEL -->
      <section class="settings-card">
        <h2>Innstillinger</h2>

        <label>Hvem skriver du til?</label>
        <input type="text" placeholder="Skriv hvem du skriver til" />

        <label>Tone</label>
        <input type="text" placeholder="Skriv tonen (f.eks. romantisk)" />

        <label>Lengde</label>
        <input type="text" placeholder="Kort, middels eller lang" />

        <label for="stil">Språk</label>
        <input id="stil" type="text" placeholder="Skriv språk" />
      </section>

      <!-- HØYRE PANEL -->
      <section class="chat-window">
        <div id="chat-messages" class="chat-messages"></div>

        <textarea
          id="chat-input"
          class="chat-input"
          placeholder="Skriv meldingen..."
        ></textarea>

        <div class="chat-buttons">
          <button class="btn primary small" onclick="sendMessage()">
            Generer svar
          </button>
        </div>
      </section>

      <script>
        const chatInput = document.getElementById("chat-input");
        const chatMessages = document.getElementById("chat-messages");
        let firstClickDone = false; // holder styr på første klikk

        function createMessageElement(message, sender) {
          const div = document.createElement("div");
          div.classList.add("chat-bubble", sender); // 'user' eller 'bot'
          div.innerText = message;
          return div;
        }

        function sendMessage() {
          const message = chatInput.value.trim();
          if (!message) return;

          // Vis brukerens melding
          chatMessages.appendChild(createMessageElement(message, "user"));
          chatInput.value = "";

          // Send til Flask
          fetch("/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ melding: message }),
          })
            .then((res) => res.json())
            .then((data) => {
              // Vis botens svar
              chatMessages.appendChild(
                createMessageElement(data.forslag, "bot")
              );
              chatMessages.scrollTop = chatMessages.scrollHeight; // scroll til siste melding
            });

          firstClickDone = true;
        }

        // Lytt på Enter-tast
        chatInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            // Shift+Enter for linjeskift
            e.preventDefault();
            if (firstClickDone) {
              sendMessage();
            }
          }
        });

        // Første gang må man klikke på knappen
        document
          .querySelector(".btn.primary.small")
          .addEventListener("click", sendMessage);
      </script>
    </main>

    <footer class="site-footer">
      <p>© 2025 SmartSvar</p>
    </footer>
  </body>
</html>
